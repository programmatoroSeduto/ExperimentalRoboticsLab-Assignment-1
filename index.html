<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RCL - RoboCLuedo: README - Experimental Robotics Lab - Assignment 1 - RoboCLuedo</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cluedologo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RCL - RoboCLuedo
   &#160;<span id="projectnumber">v1.0</span>
   </div>
   <div id="projectbrief">Francesco Ganci - S4143910 - Experimental Robotics Lab - Assignment 1</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README - Experimental Robotics Lab - Assignment 1 - RoboCLuedo </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Francesco Ganci - 4143910</b> - Robotics Engineering - A.A. 2021/2022</p>
<blockquote class="doxtable">
<p>Documentation:</p>
<ul>
<li><a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/files.html">Doxygen Documentation Here</a></li>
<li><a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00350.html">UML diagrams</a></li>
</ul>
<p>For a practical point of view on this project,</p>
<ul>
<li>See the <a href="#a-practical-example">practical example</a> </li>
</ul>
</blockquote>
<div class="image">
<img src="cluedologo.jpg" alt=""/>
<div class="caption">
CLuedo</div></div>
   <h1><a class="anchor" id="autotoc_md7"></a>
RCL - Introduction</h1>
<p>This project contains a ROS implementation of the control program of a robot which can play to a very limited and simplified version of the well-known game CLuedo. Here is implemented only the logic structure of the system, which can be easily extended and possiblty "mounted" on a real robot.</p>
<p>A behavioural architecture is implemented here. The robot "moves" among the rooms of a house in order to find who, where, and with what DrBlack was killed. The project also employs artificial intelligence techniques in order to solve the case. The robot interacts with a particular node, called <b>Oracle</b>, which is responsible for giving "hints" to the robot. The oracle knows the solution of the case, and checks the solution proposed by the robot each time it is ready to make a charge. If the proposed solution is correct, the program stops.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
RCL - Packages Structure</h1>
<p>The project is distributed into two different packages:</p>
<ul>
<li><b>robocluedo</b> : the main folder of the project, containing the implementation</li>
<li><b>robocluedo_msgs</b> : it contains some useful utilities for the project. I decided to split the project for clarity reasons.</li>
</ul>
<h2><a class="anchor" id="autotoc_md9"></a>
Package robocluedo</h2>
<p>It contains the main part of the architecture. You can configure how it works from the <em>config</em> folder, and test it using the launch files (see below in this document).</p>
<div class="fragment"><div class="line">robocluedo</div>
<div class="line">├───config                   &lt;&gt; file parameters.launch</div>
<div class="line">│   ├───cluedo_items         &lt;&gt; cluedo items in three text files</div>
<div class="line">│   └───cluedo_owl_ontology  &lt;&gt; base ontology</div>
<div class="line">│       └───last_ontology    &lt;&gt; backup of the ontology from the last execution</div>
<div class="line">|</div>
<div class="line">├───docs                     &lt;&gt; diagrams, examples on the project, adn other pages</div>
<div class="line">│   ├───diagrams</div>
<div class="line">│   ├───examples</div>
<div class="line">│   └───img</div>
<div class="line">|</div>
<div class="line">├───include                  </div>
<div class="line">│   └───armor_tools          &lt;&gt; headers of the classes ArmorTools and ArmorCluedo</div>
<div class="line">|</div>
<div class="line">├───launch                   &lt;&gt; main launch file</div>
<div class="line">│   └───tests                &lt;&gt; other launch files for testing the arch</div>
<div class="line">|</div>
<div class="line">├───logs                     &lt;&gt; log files from previous tests on the complete architecture</div>
<div class="line">|</div>
<div class="line">├───scripts                  &lt;&gt; the main node, and other py nodes for testing the arch</div>
<div class="line">|</div>
<div class="line">└───src                      &lt;&gt; C++ nodes for the project</div>
<div class="line">    └───armor_tools          &lt;&gt; implementation of the classes ArmorTools and ArmorCluedo</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
Package robocluedo_msgs</h2>
<p>This package contains the messages and the services for the project. Please refer to the <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/dir_b4533bfc40db8e2efccd35494a74693f.html">documentation</a>.</p>
<div class="fragment"><div class="line">robocluedo_msgs</div>
<div class="line">|</div>
<div class="line">├───msg</div>
<div class="line">│       Hint.msg</div>
<div class="line">│       Hypothesis.msg</div>
<div class="line">│</div>
<div class="line">└───srv</div>
<div class="line">        AddHint.srv</div>
<div class="line">        CheckSolution.srv</div>
<div class="line">        DiscardHypothesis.srv</div>
<div class="line">        FindConsistentHypotheses.srv</div>
<div class="line">        GoTo.srv</div>
<div class="line">        RandomRoom.srv</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md11"></a>
Install and Running the project</h1>
<h2><a class="anchor" id="autotoc_md12"></a>
dependencies</h2>
<p>In order to run the project you need to install the followings:</p>
<ul>
<li><a href="http://wiki.ros.org/rosjava">ROSJava</a></li>
<li><a href="https://github.com/EmaroLab/armor#armor">aRMOR</a> : a ROS tool, working on ROSJava, able to manipulate .owl fles; please follow the instruction available on the readme of aRMOR in order to install it.</li>
<li><a href="https://github.com/EmaroLab/multi_ontology_reference">AMOR</a> : required by aRMOR, see the instructions of aRMOR</li>
<li><a href="https://github.com/EmaroLab/armor_msgs">aRMOR msgs</a> : required in order to build the project.</li>
</ul>
<p>No Py client is required: the client was re-implemented in C++, see <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00201.html#details">ArmorTools</a> in the documentation.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Build the project</h2>
<p>With the above mentioned depts installed, building the project is straightforward:</p>
<p>0. I always recommend to create a clean workspace before downloading the project.</p><ol type="1">
<li>Clone this repository inside the folder <code>src</code></li>
<li>then, <code>catkin_make</code> on the entire workspace</li>
</ol>
<p>Sometimes, for some strange reason, <code>catkin_make</code> gets stuck and doesn't compile the entire workspace. In order to force catkin to compile everythin, there's a script <code>compile.sh</code> attached to this repository. It simply calls <em>catkin</em> for each package of the project.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Running the project</h2>
<p>There are at least two ways to run the architecture.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
First way - Launch file</h3>
<p>You can run the entire program from the launch file I provided for you:</p>
<div class="fragment"><div class="line">clear &amp;&amp; roslaunch robocluedo run_robocluedo.launch</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md16"></a>
Second way - Slow method</h3>
<p>Before starting, remember to launch the ROS master:</p>
<div class="fragment"><div class="line">roscore &amp;</div>
</div><!-- fragment --><p>First of all, you need to set some stuff on the parameter server. You can easily do it from the launch file you can find in <code>robocluedo/config</code>:</p>
<div class="fragment"><div class="line">roslaunch robocluedo parameters.launch</div>
</div><!-- fragment --><p>Done this, there are a couple of nodes to start. I suggest you to run aRMOR before the other nodes. Don't load anything: the arch. will load everything after starting. You could notice some warnigs: ignore them.</p>
<div class="fragment"><div class="line">rosrun armor execute it.emarolab.armor.ARMORMainService &amp;</div>
</div><!-- fragment --><p>Then, launch the auxiliary nodes. The node <code>cluedo_armor_interface</code> will set up the aRMOR service loading the ontology file you can find in <code>robocluedo/config/cluedo_owl_ontology</code>. This node manages and simplifies the usage of the ontology, and provides services specific for this project.</p>
<div class="fragment"><div class="line">rosrun robocluedo cluedo_armor_interface &amp;</div>
</div><!-- fragment --><p>Now, run the node <code>cluedo_random_room</code>, a simple server which chooses one room among the ones in the list you can find at <code>robocluedo/config/cluedo_items</code>:</p>
<div class="fragment"><div class="line">rosrun robocluedo cluedo_random_room &amp;</div>
</div><!-- fragment --><p>Run now the movement controller. This is a stub implementation: it should be replaced with a real movement controller, with no need to alter the interface of the architecture. Actually, it is a blocking service which can also cause the Oracle to send a hint to the robot.</p>
<div class="fragment"><div class="line">rosrun robocluedo cluedo_movement_controller &amp;</div>
</div><!-- fragment --><p>The cluedo oracle is the referee of the game. Its interface should be external to this project: the actual oracle can be easily replaced. The oracle reads three files of items (see the folder <code>robocluedo/config/cluedo_items</code>), and prepares the case, choosing the solution in advance. You can retrieve the solution from the output on the console.</p>
<div class="fragment"><div class="line">rosrun robocluedo cluedo_oracle &amp;</div>
</div><!-- fragment --><p>The last node you should run is the <code><a class="el" href="a00207.html">robocluedo_main</a></code>, which implements the FSM, so the center of the architecture. The node makes the whole architecture running: the robot starts to work.</p>
<div class="fragment"><div class="line">rosrun robocluedo robocluedo_main.py</div>
</div><!-- fragment --><p>That's all folks!</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Configuring the project - settings</h2>
<p>All the configuration elements are located in the folder <code>robocluedo/config</code>. Here you can find:</p>
<ul>
<li>the launch file <code>parameter.launch</code> which contains all the parameters to be defined before running the architecture</li>
<li>a folder <code>cluedo_items</code> containing all the entities for the game</li>
<li>a folder <code>cluedo_ontology</code> containing the base ontology (the file <em>cluedo_ontology.owl</em>) ...</li>
<li>.. and another folder <code>cluedo_ontology/last_ontology</code> where the node <em><a class="el" href="a00207.html">robocluedo_main</a></em>, through the interface <em>robocluedo_armor_interface</em>, exports the ontology from the last execution of the robot. For debug purposes, you can inspect them, but first I suggest you to take a look at the documentation <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00197.html">about ArmorCluedo</a> and in particular the section "DISCARD HYPOTHESIS" from the <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00231.html">example 3</a> of <a class="el" href="a00215.html" title="additional utilities for aRMOR">ArmorCluedo</a>.</li>
</ul>
<p>Here is the structure of the folder <code>config</code>:</p>
<div class="fragment"><div class="line">robocluedo</div>
<div class="line">├───config</div>
<div class="line">│   │   parameters.launch</div>
<div class="line">│   │</div>
<div class="line">│   ├───cluedo_items</div>
<div class="line">│   │       cluedo_what.txt</div>
<div class="line">│   │       cluedo_where.txt</div>
<div class="line">│   │       cluedo_who.txt</div>
<div class="line">│   │</div>
<div class="line">│   └───cluedo_owl_ontology</div>
<div class="line">│       │   cluedo_ontology.owl</div>
<div class="line">│       │</div>
<div class="line">│       └───last_ontology</div>
<div class="line">│               cluedo_last_ontology.owl</div>
<div class="line">...</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
Parameters and Item Files</h3>
<p>The program need three test files:</p>
<ul>
<li><code>cluedo_path_where</code> : the path of the file text containing all the PLACEs</li>
<li><code>cluedo_path_what</code> : the the path of the file text containing all the WEAPONs</li>
<li><code>cluedo_path_who</code> : the path of the file text containing all the PERSONs</li>
</ul>
<p>Each file has a very simple structure: each line corresponds to an item of a given class. No parsing is needed: the program just imports them, reading line per line.</p>
<p>Regarding the ontology:</p>
<ul>
<li><code>cluedo_path_owlfile</code> : the path where the base ontology is located</li>
<li><code>cluedo_path_owlfile_backup</code> : the path where to export the actual ontology</li>
</ul>
<p>Items are loaded <em>dynamically</em> into the ontology, i.e. when the Oracle gives to the robot a property containing an item which it hasn't seen before.</p>
<p>Another value is:</p>
<ul>
<li><code>cluedo_max_hypotheses</code> : the number of IDs generated by the Oracle</li>
</ul>
<p>Each hint has an ID; this lets to simplify the code of the node <em>cluedo_armor_interface</em>, otherwise the robot should assign a ID and expand the hint in a combinatorial way, making the research of complete hypotheses more difficult to execute.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Testing the components</h2>
<p>During the development of the application, they are been implemented several nodes which have the only purpose to test parts of the applications. Here is the complete list of the launch files and the type of test performed:</p>
<ul>
<li><code><a class="el" href="a00113.html">test_armor.launch</a></code> : the C++ node <code><a class="el" href="a00173.html" title="A preliminary test on aRMOR service.">test_armor.cpp</a></code> performs a simple reasoning task on the ontology interacting directly with the aRMOR service. It offers many handy functions which simplify the communication with aRMOR: it is meant to be modified and recompiled several times. If you want to alter it, of course you can: please follow the examples.</li>
<li><code><a class="el" href="a00116.html">test_armor_tools.launch</a></code> : the previous test is too much 'direct' and doesn't use <a class="el" href="a00219.html" title="A minimal C++ client for aRMOR.">ArmorTools</a> neither <a class="el" href="a00215.html" title="additional utilities for aRMOR">ArmorCluedo</a>. The node <code><a class="el" href="a00176.html" title="Testing the interface ArmorCluedo.">test_armor_tools.cpp</a></code> offers a more rigorous testing using the C++ client (see <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/dir_fd8dfb9d206235f5e2cbee914cef037a.html">the documentation</a>). Unfortunately it is still in Italian (most of the part).</li>
<li><code><a class="el" href="a00119.html">test_cluedo_armor_interface.launch</a></code> : this simple test performs a rapid sequence of operations on <code>cluedo_armor_interface</code>, a simple pattern of reasoning.</li>
<li><code><a class="el" href="a00122.html">test_cluedo_oracle.launch</a></code> : simple test for the hint request in <code><a class="el" href="a00167.html" title="The referee of the game.">cluedo_oracle.cpp</a></code>; perform the request of a hint 25 times.</li>
<li><code><a class="el" href="a00125.html">test_cluedo_random_room.launch</a></code> : same pattern as the previous, perform the request of a room for 50 times.</li>
<li><code><a class="el" href="a00128.html">test_oracle_plus_interface.launch</a></code> : joint test between <code>cluedo_oracle</code> and <code>cluedo_armor_tools</code>; the node asks to the Oracle a hint for a number of times, and each time the oracle replies. the hint is given to aRMOR through <em>cluedo_armor_interface</em>. All the features of both <em>cluedo_armor_interface</em> and <em>cluedo_oracle</em> are tested here.</li>
</ul>
<h1><a class="anchor" id="autotoc_md20"></a>
RCL - How RoboCLuedo Works</h1>
<p>Here is a short presentation of the work done in this project.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
The components of the project</h2>
<p>This is a behavioural architecture without the <em>sense</em> part. Here is the UML diagram of the whole project:</p>
<div class="image">
<img src="UML_components_arch_sketch.png" alt=""/>
<div class="caption">
CLuedo</div></div>
   <p>Let's introduce the architecture node by node. If you want to know more about the central node, jump to the next section about the finite state machine.</p>
<h3><a class="anchor" id="autotoc_md22"></a>
NODE – cluedo_random_room</h3>
<blockquote class="doxtable">
<p>implementation <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00152.html">here</a> </p>
</blockquote>
<p>This is a simple node which chooses randomly a place from the PLACEs file. it is used when the robot is searching for clues. It exposes only one service.</p>
<div class="image">
<img src="UML_components_cluedo_random_room.png" alt=""/>
<div class="caption">
CLuedo</div></div>
   <h3><a class="anchor" id="autotoc_md23"></a>
NODE – cluedo_movement_controller</h3>
<blockquote class="doxtable">
<p>implementation <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00146.html">here</a> </p>
</blockquote>
<p>This is a "stub" node, i.e. it represents a logical role but it does nothing. It represents the <em>act</em> part of the behavioural architecture; it can be replaced with a real movement controller easily.</p>
<div class="image">
<img src="UML_components_cluedo_movement_controller.png" alt=""/>
<div class="caption">
CLuedo</div></div>
   <p>Note that that the this node has also a channel connected with the Cluedo Oracle. The principle: the robot would receive one hint when it enters in the room, so the movement controller sends a signal every time the robot "reaches" a position. The signal is a message through the topic, which the oracle could accept or not.</p>
<h3><a class="anchor" id="autotoc_md24"></a>
NODE – cluedo_oracle</h3>
<blockquote class="doxtable">
<p>implementation <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00149.html">here</a> </p>
</blockquote>
<p>This node implements a sort of referee for the game. It knows the solution of the case, and can check, through service, the solutions proposed by the node <a class="el" href="a00207.html">robocluedo_main</a>. Sometimes it can also give hints, i.e. propositions which the robot collects and associates in order to formulate a possible solution to be checked. <em>The solution could be incorrect</em>, so every time the robot has a solution, it must check it using a service of the oracle.</p>
<div class="image">
<img src="UML_components_cluedo_oracle.png" alt=""/>
<div class="caption">
CLuedo</div></div>
   <p>The solution is generated in this way. First of all, the oracle chooses the ID of the solution. Then, after read the item files, the oracle bulds a shuffled list of <a href="see.hint.message">hint items</a>. For each ID, the node generates from zero to <a href="doxygen.MAX_SIZE_HINT.link">MAX_SIZE_HINT</a>. It should be possible (but very seldom) that one ID has not related hints.</p>
<h3><a class="anchor" id="autotoc_md25"></a>
NODE – cluedo_armor_interface</h3>
<blockquote class="doxtable">
<p>implementation <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00143.html">here</a> </p>
</blockquote>
<p>The node implements a simplified and specific interface which lets other nodes to work with aRMOR without using direct calls to the aRMOR service.</p>
<div class="image">
<img src="UML_components_cluedo_armor_interface.png" alt=""/>
<div class="caption">
CLuedo</div></div>
   <p>The interface has four services (all the names of the services are under **/cluedo_armor**):</p><ul>
<li><b>add_hint</b> : add a proerty to the ontology, adding the implied values if at least one of them doesn't exist. See the <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00143_a4867095aa20f38de61e518e16253520b.html#a4867095aa20f38de61e518e16253520b">implementation of ServiceAddHint()</a></li>
<li><b>find_consistent_h</b> : retrieve all the consistet hypotheses from aRMOR. See the <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00143_a7ac3004a3cbe78bf0b2c234d11354c43.html#a7ac3004a3cbe78bf0b2c234d11354c43">implementation of ServiceFindConsistentHypotheses()</a></li>
<li><b>wrong_hypothesis</b> : discards a hypothesis after a negative result from the oracle about one conclusion. See the <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00143_a85e8c9731bfed7d2e82df47750b9c19e.html#a85e8c9731bfed7d2e82df47750b9c19e">implementation of DiscardHypothesis()</a></li>
<li><b>backup</b> : the service exports the actual ontology into the .owl backup file. See configurations, and the <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00143_a66c612700258bd528a8d54035044b4ec.html#a66c612700258bd528a8d54035044b4ec">implementation of ServiceBackupOntology()</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md26"></a>
C++ CLASS – ArmorTools</h3>
<blockquote class="doxtable">
<p>implementation <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00201.html">here</a> </p>
</blockquote>
<p>This class implements the most common mid-level methods for dealing with aRMOR without direct calls to the service. See the implementation for further details, and in particular <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/examples.html">the examples</a> for more details.</p>
<p>Other useful documents:</p>
<ul>
<li><a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00233.html">Example 1</a> : <a class="el" href="a00219.html" title="A minimal C++ client for aRMOR.">ArmorTools</a> - 001 - Essential usage of <a class="el" href="a00219.html" title="A minimal C++ client for aRMOR.">ArmorTools</a></li>
<li><a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00235.html">Example 2</a> : <a class="el" href="a00219.html" title="A minimal C++ client for aRMOR.">ArmorTools</a> - 002 - The quickest way to use <a class="el" href="a00219.html" title="A minimal C++ client for aRMOR.">ArmorTools</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md27"></a>
C++ CLASS – ArmorCluedo</h3>
<blockquote class="doxtable">
<p>implementation <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00197.html">here</a> </p>
</blockquote>
<p>The class extends the class ArmorToold, adding more handy specific mid-level methods for working with CLuedo individuals, properties and hypotheses. It adds also some workarounds needed in order tomake reliable the operations on aRMOR and overcoming some issues in commands DISJOINT and REMOVE. Please refer to the documentation if you want more details about all these aspects.</p>
<p>Here are some useful documents:</p>
<ul>
<li><a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00227.html">Example 1</a> : <a class="el" href="a00215.html" title="additional utilities for aRMOR">ArmorCluedo</a> - 001 - Working on Individuals</li>
<li><a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00229.html">Example 2</a> : <a class="el" href="a00215.html" title="additional utilities for aRMOR">ArmorCluedo</a> - 002 - Working with properties</li>
<li><a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00231.html">Example 3</a> : <a class="el" href="a00215.html" title="additional utilities for aRMOR">ArmorCluedo</a> - 003 - Reasoning Workflow</li>
<li><a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00158.html">test_armor_tools</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md28"></a>
The Finite State Machine – robocluedo_main</h2>
<p>The python ROS node <b><a class="el" href="a00207.html">robocluedo_main</a></b> implements the behaviour of the robot. The ROS framework <a href="http://wiki.ros.org/smach">SMACH</a> is employed here in order to implement the Finite State Machine.</p>
<p>Here is the FSM diagram:</p>
<div class="image">
<img src="UML_FSM_sketch.png" alt=""/>
<div class="caption">
CLuedo</div></div>
   <p>Note that the robot could receive a message each time it enters in the room, <em>only one message</em> because the buffer is actually a single variable instead of a list of hints (see the <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00188.html">todo list</a> in the documentation). The behavour of the robot can be summarized as follows:</p>
<ul>
<li>when no complete hypotheses are available, the robot moves choosing randomly a room where to go</li>
<li>each time the robot enters in a room, it "could find or not" one clue. If it "finds" something, it adds the hint to the ontology</li>
<li>each time, the robot checks for any complete hypothesis; if it finds at least one complete hypothesis, it goes into the room and makes the charge</li>
<li>the case is solved when the oracle confirms the conclusion of the robot, whereas, in case of negative answer, the robot keeps look for clues among the rooms</li>
</ul>
<p>Clearly it is a oversimplified game dynamic: <em>the real CLuedo doesn't work in this way...</em></p>
<h1><a class="anchor" id="autotoc_md29"></a>
RCL - Other notes on the project</h1>
<h2><a class="anchor" id="autotoc_md30"></a>
A practical example</h2>
<p>In order to show you how the project works I think it is more useful to present you a possible log from the project, using this test configuration:</p>
<ul>
<li>the item lists are reduced to only two elements per list.<ul>
<li>PLACE: bathroom, study.</li>
<li>PERSON: plum, mustard.</li>
<li>WEAPON: revolver, dagger.</li>
</ul>
</li>
<li>the maximum number of IDs is 4</li>
</ul>
<p>You can find both the log and the end ontology from the folder <a href="https://github.com/programmatoroSeduto/ExperimentalRoboticsLab-Assignment-1/tree/main/robocluedo/logs/test_20211109"><code>/logs/test_20211109</code></a>. In this example, the program was launched using the main launch file, that suppresses some logs, for example the ones from the cluedo_armor_interface. Only the logs belonging to the oracle and the <a class="el" href="a00207.html">robocluedo_main</a> node are visible, since I think they're the most relevant nodes in the architecture.</p>
<p>Before starting, all the secundary components start running, and the config files are loaded.</p>
<div class="fragment"><div class="line">[ INFO] [1636487503.092018000]: [cluedo_oracle] reading from fiile [/root/ws_experimental_robotics_lab_assignment_1/src/ExperimentalRoboticsLab-Assignment-1/robocluedo/config/cluedo_items/cluedo_who.txt] </div>
<div class="line">[ INFO] [1636487503.092848100]: [cluedo_oracle] line[1] READ [plum] </div>
<div class="line">[ INFO] [1636487503.092901500]: [cluedo_oracle] line[2] READ [mustard] </div>
<div class="line">[ INFO] [1636487503.092950600]: [cluedo_oracle] closing file ...</div>
<div class="line">[ INFO] [1636487503.093006600]: [cluedo_oracle] reading from fiile [/root/ws_experimental_robotics_lab_assignment_1/src/ExperimentalRoboticsLab-Assignment-1/robocluedo/config/cluedo_items/cluedo_where.txt] </div>
<div class="line">[ INFO] [1636487503.093062800]: [cluedo_oracle] line[1] READ [study] </div>
<div class="line">[ INFO] [1636487503.093111100]: [cluedo_oracle] line[2] READ [bathroom] </div>
<div class="line">[ INFO] [1636487503.093157200]: [cluedo_oracle] closing file ...</div>
<div class="line">[ INFO] [1636487503.093205400]: [cluedo_oracle] reading from fiile [/root/ws_experimental_robotics_lab_assignment_1/src/ExperimentalRoboticsLab-Assignment-1/robocluedo/config/cluedo_items/cluedo_what.txt] </div>
<div class="line">[ INFO] [1636487503.093260300]: [cluedo_oracle] line[1] READ [dagger] </div>
<div class="line">[ INFO] [1636487503.093305700]: [cluedo_oracle] line[2] READ [revolver] </div>
<div class="line">[ INFO] [1636487503.093352000]: [cluedo_oracle] closing file ...</div>
</div><!-- fragment --><p>In particular the Oracle prepares the case and chooses the solution. In this case, the generated solution has ID zero, and we know what is from the log:</p>
<div class="fragment"><div class="line">        ...</div>
<div class="line">[ INFO] [1636487503.093892400]: [cluedo_oracle] found a max number of hypotheses: 4</div>
<div class="line">[ INFO] [1636487503.093940200]: [cluedo_oracle] case generation started </div>
<div class="line">[ INFO] [1636487503.093992500]: [cluedo_oracle] the solution is (where:study, who:mustard, what:dagger)</div>
<div class="line">[ INFO] [1636487503.094038100]: [cluedo_oracle] the solution has ID:0</div>
<div class="line">[ INFO] [1636487503.094091800]: [cluedo_oracle] hints generation finished. Generated: 19 hints</div>
</div><!-- fragment --><p>The main node waits for the services and the topics, until all the nodes are ready.</p>
<div class="fragment"><div class="line">        ...</div>
<div class="line">[ INFO] [1636487503.094138700]: [cluedo_oracle] subscribing to the topic [/hint_signal] ...</div>
<div class="line">[ INFO] [1636487503.095897700]: [cluedo_oracle] subscribing to the topic [/hint_signal] ... OK</div>
<div class="line">[ INFO] [1636487503.095975500]: [cluedo_oracle] Creating publisher [/hint] ...</div>
<div class="line">[ INFO] [1636487503.097834100]: [cluedo_oracle] Creating publisher [/hint] ... OK</div>
<div class="line">[ INFO] [1636487503.097998500]: [cluedo_oracle] Advertising service [/check_solution] ...</div>
<div class="line">[ INFO] [1636487503.099094600]: [cluedo_oracle] Advertising service [/check_solution] ... OK</div>
<div class="line">[ INFO] [1636487503.099201000]: [cluedo_oracle] ready!</div>
<div class="line">log4j:WARN No appenders could be found for logger (org.ros.internal.node.client.Registrar).</div>
<div class="line">log4j:WARN Please initialize the log4j system properly.</div>
<div class="line">log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.</div>
<div class="line">[INFO] [1636487503.802970]: [robocluedo_main] calling service /go_to ...</div>
<div class="line">[INFO] [1636487503.804739]: [robocluedo_main] OK</div>
<div class="line">[INFO] [1636487503.805391]: [robocluedo_main] calling service /random_room ...</div>
<div class="line">[INFO] [1636487503.806928]: [robocluedo_main] OK</div>
<div class="line">[INFO] [1636487503.807626]: [robocluedo_main] subscribing to /hint ...</div>
<div class="line">[INFO] [1636487503.809300]: [robocluedo_main] OK</div>
<div class="line">[INFO] [1636487503.810581]: [robocluedo_main] calling service /check_solution ...</div>
<div class="line">[INFO] [1636487503.812781]: [robocluedo_main] OK</div>
<div class="line">[INFO] [1636487503.813683]: [robocluedo_main] calling service /cluedo_armor/add_hint ...</div>
<div class="line">[INFO] [1636487504.719390]: [robocluedo_main] OK</div>
<div class="line">[INFO] [1636487504.720344]: [robocluedo_main] calling service /cluedo_armor/find_consistent_h ...</div>
<div class="line">[INFO] [1636487504.722123]: [robocluedo_main] OK</div>
<div class="line">[INFO] [1636487504.722945]: [robocluedo_main] calling service /cluedo_armor/wrong_hypothesis ...</div>
<div class="line">[INFO] [1636487504.724579]: [robocluedo_main] OK</div>
<div class="line">[INFO] [1636487504.725292]: [robocluedo_main] asking for service [/cluedo_armor/backup] ...</div>
<div class="line">[INFO] [1636487504.726978]: [robocluedo_main] OK!</div>
</div><!-- fragment --><p>When all the nodes are ready, the robot can start moving.</p>
<div class="fragment"><div class="line">        ...</div>
<div class="line">[INFO] [1636487504.730808]: [robocluedo_main] starting the FSM...</div>
<div class="line">[INFO] [1636487504.731578]: State machine starting in initial state &#39;robocluedo_random_target&#39; with userdata: </div>
<div class="line">    []</div>
</div><!-- fragment --><p>Here is a representation of what happened up to now:</p>
<div class="image">
<img src="UML_sequence_example_loading.png" alt=""/>
<div class="caption">
UML sequence loading</div></div>
   <p>At the beginning, the robot has no informations: the ontology is empty, so it chooses randomly a room asking to the node cluedo_random_room in search of clues. Each time it enteres in one room, it receives <em>at most</em> one hint, or also nothing in some cases. The robot keeps behave in this way until at least one hypothesis becomes complete. In the following piece of log, the typical job of the robot while is looking for clues:</p>
<div class="fragment"><div class="line">        ...</div>
<div class="line">[INFO] [1636487510.302336]: [state:random_target] actual position: bathroom | random target: bathroom</div>
<div class="line">[INFO] [1636487510.303734]: State machine transitioning &#39;robocluedo_random_target&#39;:&#39;move_robot&#39;--&gt;&#39;robocluedo_moving&#39;</div>
<div class="line">[ INFO] [1636487511.307296200]: [cluedo_oracle] publishing hint (ID:0, PROP:who, VALUE:mustard)</div>
<div class="line">[INFO] [1636487511.307459]: [state:moving] reached position: bathroom </div>
<div class="line">[INFO] [1636487511.308630]: State machine transitioning &#39;robocluedo_moving&#39;:&#39;target_reached_no_charge&#39;--&gt;&#39;robocluedo_listening_for_hints&#39;</div>
<div class="line">[INFO] [1636487511.309457]: [state:listening_for_hints] received a hint</div>
<div class="line">[INFO] [1636487511.310390]: State machine transitioning &#39;robocluedo_listening_for_hints&#39;:&#39;received_a_hint&#39;--&gt;&#39;robocluedo_update_ontology&#39;</div>
<div class="line">[INFO] [1636487511.311347]: [state:update_ontology] received hint: HP0(who:mustard)</div>
<div class="line">[INFO] [1636487511.379564]: [state:update_ontology] writing backup of the ontology...</div>
<div class="line">[INFO] [1636487511.412380]: [state:update_ontology] ontology saved</div>
<div class="line">[INFO] [1636487511.413624]: State machine transitioning &#39;robocluedo_update_ontology&#39;:&#39;done&#39;--&gt;&#39;robocluedo_reasoning&#39;</div>
<div class="line">[INFO] [1636487511.432874]: State machine transitioning &#39;robocluedo_reasoning&#39;:&#39;no_consistent_hp&#39;--&gt;&#39;robocluedo_random_target&#39;</div>
</div><!-- fragment --><p>A representation of what is happening in the common cycle above mentioned. The worst case scenario is assumed.</p>
<div class="image">
<img src="UML_sequence_example_working_cycle.png" alt=""/>
<div class="caption">
UML sequence working cycle</div></div>
   <p>In the example, there are no wrong charges unfortunately, but it is reasonable to suppose that, on a more complex setup (many elements in the list, many IDs, ...) the robot could fail sometimes. Here is the final piece of the log, which shows how the robot behaves when it is ready to present a charge.</p>
<div class="fragment"><div class="line">        ...</div>
<div class="line">[INFO] [1636487535.449865]: State machine transitioning &#39;robocluedo_reasoning&#39;:&#39;no_consistent_hp&#39;--&gt;&#39;robocluedo_random_target&#39;</div>
<div class="line">[INFO] [1636487535.452961]: [state:random_target] actual position: study | random target: bathroom</div>
<div class="line">[INFO] [1636487535.453893]: State machine transitioning &#39;robocluedo_random_target&#39;:&#39;move_robot&#39;--&gt;&#39;robocluedo_moving&#39;</div>
<div class="line">[ INFO] [1636487536.456438300]: [cluedo_oracle] publishing hint (ID:0, PROP:where, VALUE:study)</div>
<div class="line">[INFO] [1636487536.456450]: [state:moving] reached position: bathroom </div>
<div class="line">[INFO] [1636487536.458016]: State machine transitioning &#39;robocluedo_moving&#39;:&#39;target_reached_no_charge&#39;--&gt;&#39;robocluedo_listening_for_hints&#39;</div>
<div class="line">[INFO] [1636487536.459015]: [state:listening_for_hints] received a hint</div>
<div class="line">[INFO] [1636487536.459973]: State machine transitioning &#39;robocluedo_listening_for_hints&#39;:&#39;received_a_hint&#39;--&gt;&#39;robocluedo_update_ontology&#39;</div>
<div class="line">[INFO] [1636487536.460861]: [state:update_ontology] received hint: HP0(where:study)</div>
<div class="line">[INFO] [1636487536.473777]: [state:update_ontology] writing backup of the ontology...</div>
<div class="line">[INFO] [1636487536.494515]: [state:update_ontology] ontology saved</div>
<div class="line">[INFO] [1636487536.496134]: State machine transitioning &#39;robocluedo_update_ontology&#39;:&#39;done&#39;--&gt;&#39;robocluedo_reasoning&#39;</div>
<div class="line">[INFO] [1636487536.513820]: [state:reasoning] complete hypotheses found: 1</div>
</div><!-- fragment --><p>If the number of hypotheses would have been 2, the robot have been choosen randomly from the available ones. Here there's only one hypothesis, and it will be so every time because the robot "thinks" every time it enters in a room, and at most one hint can be sent to the robot: if the oracle would send more than one hint at time, the robot have had ore elements to elaborate.</p>
<p>The actual position is not the one mentioned in the hypothesis, so the robot first moves towards the room, and when is there, makes the charge. The solution is correct, so the program ends.</p>
<div class="fragment"><div class="line">[INFO] [1636487536.515209]: [state:reasoning] HP0(who:mustard, where:study, what:dagger)</div>
<div class="line">[INFO] [1636487536.516173]: [state:reasoning] selected hyp. with tag: HP0 | actual position: bathroom</div>
<div class="line">[INFO] [1636487536.517029]: State machine transitioning &#39;robocluedo_reasoning&#39;:&#39;not_in_the_right_place&#39;--&gt;&#39;robocluedo_moving&#39;</div>
<div class="line">[ INFO] [1636487537.519778200]: [cluedo_oracle] publishing hint (ID:1, PROP:what, VALUE:revolver)</div>
<div class="line">[INFO] [1636487537.519989]: [state:moving] reached position: study </div>
<div class="line">[INFO] [1636487537.521567]: State machine transitioning &#39;robocluedo_moving&#39;:&#39;target_reached_ready_for_charge&#39;--&gt;&#39;robocluedo_charge&#39;</div>
<div class="line">[INFO] [1636487537.522649]: [state:charge] asking to the oracle: (who:mustard, where:study, what:dagger)</div>
<div class="line">[ INFO] [1636487537.524821900]: [cluedo_oracle] evaluating the solution WHERE[study]  WHO [mustard]  WHAT [dagger] </div>
<div class="line">[ INFO] [1636487537.524905900]: [cluedo_oracle] SUCCESS! Found the solution. </div>
<div class="line">[INFO] [1636487537.525135]: [state:charge] mystery solved!</div>
<div class="line">[INFO] [1636487537.526102]: State machine terminating &#39;robocluedo_charge&#39;:&#39;case_solved&#39;:&#39;mystery_solved&#39;</div>
</div><!-- fragment --><p>The last part of the log can be resumed with this diagram:</p>
<div class="image">
<img src="UML_sequence_example_final.png" alt=""/>
<div class="caption">
UML sequence working cycle</div></div>
   <p>This was a very simple example, aimed at make you understand how this project works. Inside the directory <em>logs</em> you can find some more interesting examples with the default setup.</p>
<h2><a class="anchor" id="autotoc_md31"></a>
Working Hypotheses</h2>
<p><em>The robot works in a well-known space, at least from the logical point of view</em>. Maybe the space would be unknown, but the robot knows in advance at least the names of the rooms.</p>
<p><em>The oracle sends at most one hint each time the robot enters in a room.</em> For multiple hints, it is necessary to extend the buffering from a single-var buffer type to a list type. The changes to do are few, and the logic can work fine also relaxing this working condition.</p>
<p>In this implementation <em>the oracle sends in a precise instant the hint</em>, but this is not a constraint: the oracle can send the hint when it wants, because there's only one state which needs to check the state of the buffer. If the oracle would be replaced with another one which doesn't use the */hint_signal* but publishes the message in every instant, the architecture should work well.</p>
<p><em>The ID of the hypothesis is provided by the oracle.</em> Modifying this working hypothesis requires to change a bit the node <em><a class="el" href="a00207.html">robocluedo_main</a></em>, but also reimplement the algorithm for adding the hypotheses in the ontology, so non-trivial changes to <em>cluedo_armor_interface</em>. It should be implemented an algorithm which, given some properties, can generate all the hypotheses which contains those properties. Providing the ID instead simplifies the workflow, because the interface already knows how to organize the hypotheses, so the problem is reduced to find the right ID among the ones provided by the oracle.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Possible improvements</h2>
<p>You can find some of the possible improvements directly in the documentation of the code; see the section <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00188.html">todo</a>.</p>
<p>About the architecture:</p>
<ul>
<li>The actual <em>movement_controller</em> is just a "socket" for a real movement controller. The specifications require only that the service is <em>blocking</em>.</li>
<li>the sensing part is completely missing: actually the robot knows always its position without a localization system, and doesn't need to scan any QR code (or image processing, or sensing something) in order to understand the environment. This architecture is heaily focused on the AI part.</li>
<li>implementing the cluedo_armor_interface as an action could increase the performances. Actually, the services inside that node are the most time-consuming due to the huge number of needed aRMOR requests. See the time diagram.</li>
</ul>
<p>About how the game is managed:</p>
<ul>
<li>there's no need to a topic */hint_signal*: it has been introduced in the project only for demonstrating a more linear working situation.</li>
<li>the same oracle could manage more than one robot; it should be interesting to start the same architecture twice, and arrange a sort of challenge. It should be done using the same architecture of this project with minimal changes, or possibly with no changes. Other game dinamycs could also be implemented.</li>
</ul>
<p>About the Knowledge Base:</p>
<ul>
<li>in the real CLuedo, the knowledge is not centralized, but ditributed among the players: each player can exclude a priori some proerties, and hence all the hypotheses which contain them, and can discover, asking to the other players, new <em>real</em> clues. In the context of the project instead, it is difficult to apply some interesting reasoning technique such as the one of the real CLuedo. If the oracle indicates the part of the hypothesis not correct, the robot should understand which hypothesis is wrong in advance.</li>
<li>the actual .owl file can't distinguish between <em>inconsistent</em> hypotheses and <em>discarded</em> hypotheses, so the distinction must be implemented inside the architecture; in this case, in <em>cluedo_armor_interface</em>. Use DATAPROP in order to mark the hypotheses as discarded, or REMOVE them (see <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00197_ad29930fec7803aed87b7244e73b98bff.html#ad29930fec7803aed87b7244e73b98bff">ArmorCluedo::AddIndiv()</a>, <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00197_a4ae659375e7a6d9564973718ece248e2.html#a4ae659375e7a6d9564973718ece248e2">ArmorCluedo::RemoveHypothesis()</a> and the implementation of <a href="https://programmatoroseduto.github.io/ExperimentalRoboticsLab-Assignment-1/a00137_source.html#l00112">ArmorCluedo::ExistsIndiv()</a>)</li>
</ul>
<p>About the quality of the code:</p>
<ul>
<li>improve the actual naming convention, introducing a sort os standard more concept-oriented. Unfortunately, this is a tedious, time-consuming operation, despite the the effort to gather the use of messages in small parts of the code.</li>
<li>extend the functionalities of the classes <a class="el" href="a00219.html" title="A minimal C++ client for aRMOR.">ArmorTools</a> and <a class="el" href="a00215.html" title="additional utilities for aRMOR">ArmorCluedo</a> by adding the missing getters and setters</li>
</ul>
<h1><a class="anchor" id="autotoc_md33"></a>
Author and Contacts</h1>
<p>Designed and developed by <em>Francesco Ganci</em>, S4143910</p>
<ul>
<li><b>Email</b> : <a href="#" onclick="location.href='mai'+'lto:'+'_s4'+'14'+'391'+'0@'+'stu'+'de'+'nti'+'.u'+'nig'+'e.'+'it_'; return false;">_s414<span style="display: none;">.nosp@m.</span>3910<span style="display: none;">.nosp@m.</span>@stud<span style="display: none;">.nosp@m.</span>enti<span style="display: none;">.nosp@m.</span>.unig<span style="display: none;">.nosp@m.</span>e.it<span style="display: none;">.nosp@m.</span>_</a> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Nov 10 2021 11:27:54 for RCL - RoboCLuedo by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
